<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6a11cb">
    <meta name="description" content="Organiza tu vida universitaria en UPMH">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mi Vida UPMH">
    <link rel="manifest" href="/manifest.json">
    <title>Mi Vida UPMH</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6a11cb;
            --secondary-color: #2575fc;
            --accent-color: #ff6b6b;
            --light-color: #f8f9fa;
            --dark-color: #2d3436;
            --success-color: #00b894;
            --warning-color: #fdcb6e;
            --danger-color: #e17055;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.1);
            --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --radius: 16px;
            --transition: all 0.3s ease;
            
            /* Tema claro */
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --text-primary: #2d3436;
            --text-secondary: #777;
            --border-color: #eee;
            --shadow-color: rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --text-primary: #eee;
            --text-secondary: #aaa;
            --border-color: #2a2a40;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.3);
            --shadow-color: rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 80px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            width: 100%;
            padding: 0 15px;
        }

        /* Header M√≥vil */
        .mobile-header {
            background: var(--gradient);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .user-menu {
            display: flex;
            gap: 15px;
        }

        .user-menu i {
            font-size: 1.2rem;
        }

        .date-display {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Navegaci√≥n inferior */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px var(--shadow-color);
            z-index: 100;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            transition: background 0.3s ease;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #777;
            font-size: 0.75rem;
            transition: var(--transition);
            padding: 5px;
        }

        .nav-item.active {
            color: var(--primary-color);
            transform: translateY(-5px);
        }

        .nav-icon {
            font-size: 1.3rem;
            margin-bottom: 4px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-item.active .nav-icon {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Secci√≥n de Bienvenida */
        .welcome-card {
            background: var(--gradient);
            color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }

        .welcome-card::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255,255,255,0.1);
            transform: rotate(30deg);
        }

        .welcome-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 2;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
            position: relative;
            z-index: 2;
        }

        .progress-fill {
            height: 100%;
            background: white;
            width: 70%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 1rem 0;
        }

        .stat-item {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--card-shadow);
            transition: background 0.3s ease;
        }

        .stat-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient);
            color: white;
        }

        .stat-info {
            flex: 1;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Acciones R√°pidas */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 1.5rem 0;
        }

        .action-btn {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1.2rem 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-primary);
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: none;
            cursor: pointer;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .action-icon {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            height: 40px;
        }

        .action-emoji {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            height: 40px;
        }

        /* Cards Deslizables */
        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.5rem 0 1rem 0;
        }

        .section-title h3 {
            font-size: 1.3rem;
            color: var(--primary-color);
        }

        .see-all {
            font-size: 0.8rem;
            color: var(--secondary-color);
            text-decoration: none;
        }

        .cards-scroll {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 10px 0;
            margin: 1rem 0;
            scrollbar-width: none;
        }

        .cards-scroll::-webkit-scrollbar {
            display: none;
        }

        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1.2rem;
            min-width: 280px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
        }

        .card:active {
            transform: scale(0.98);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
            font-size: 1.2rem;
        }

        .card h3 {
            font-size: 1.1rem;
            color: var(--primary-color);
        }

        .task-item, .event-item, .person-item {
            display: flex;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .task-item:last-child, .event-item:last-child, .person-item:last-child {
            border-bottom: none;
        }

        .task-checkbox {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            accent-color: var(--primary-color);
        }

        .task-text {
            flex-grow: 1;
            font-size: 0.9rem;
        }

        .task-priority {
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .priority-high {
            background: rgba(255, 107, 107, 0.2);
            color: var(--danger-color);
        }

        .priority-medium {
            background: rgba(253, 203, 110, 0.2);
            color: #e17055;
        }

        .priority-low {
            background: rgba(0, 184, 148, 0.2);
            color: var(--success-color);
        }

        .event-time {
            background: rgba(37, 117, 252, 0.1);
            color: var(--secondary-color);
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-right: 10px;
            font-weight: 600;
            min-width: 60px;
            text-align: center;
        }

        .person-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .person-info {
            flex-grow: 1;
        }

        .person-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .person-relation {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Botones de acci√≥n en cards */
        .card-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .action-btn-small {
            background: rgba(0,0,0,0.1);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
        }

        .action-btn-small:hover {
            background: rgba(0,0,0,0.2);
        }

        .delete-btn {
            color: var(--danger-color);
        }

        .edit-btn {
            color: var(--secondary-color);
        }

        /* Bienestar Social */
        .emotion-form {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1.2rem;
            margin-bottom: 1rem;
            box-shadow: var(--card-shadow);
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
        }

        .emotion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .emotion-tag {
            padding: 0.6rem 0.8rem;
            background: var(--bg-primary);
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
            border: 1px solid var(--border-color);
        }

        .emotion-tag.active {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .emoji {
            font-size: 1rem;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-cancel {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .analysis-result {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .recommendation {
            background: rgba(0, 184, 148, 0.1);
            border-left: 4px solid var(--success-color);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0 8px 8px 0;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--bg-secondary);
            width: 100%;
            max-width: 400px;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            animation: modalAppear 0.3s ease;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-primary);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 1.5rem;
        }

        .modal-actions .btn {
            width: auto;
            flex: 1;
        }

        /* Estados vac√≠os */
        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        /* Notificaciones */
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            animation: notificationSlide 0.3s ease;
            display: none;
        }

        @keyframes notificationSlide {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Banner de Instalaci√≥n PWA */
        .install-banner {
            position: fixed;
            bottom: 80px;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            padding: 1rem;
            z-index: 999;
            display: none;
            animation: slideUp 0.3s ease;
        }

        [data-theme="dark"] .install-banner {
            background: var(--bg-secondary);
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .install-banner-content {
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .install-banner-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            flex-shrink: 0;
        }

        .install-banner-text {
            flex: 1;
        }

        .install-banner-text h3 {
            margin: 0 0 0.25rem 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .install-banner-text p {
            margin: 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .install-banner-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .install-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.9rem;
        }

        .dismiss-btn {
            background: transparent;
            color: var(--text-secondary);
            border: none;
            padding: 0.4rem 0.8rem;
            cursor: pointer;
            font-size: 0.85rem;
        }

        /* Barra de progreso de instalaci√≥n */
        .install-progress {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .install-progress-content {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 300px;
            width: 90%;
            text-align: center;
        }

        .install-progress-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .install-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(106, 17, 203, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .install-progress-fill {
            height: 100%;
            background: var(--gradient);
            width: 0%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .install-progress-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header M√≥vil -->
    <header class="mobile-header">
        <div class="header-top">
            <div class="logo">
                <h1>Mi Vida UPMH üéì</h1>
            </div>
            <div class="user-menu">
                <i class="fas fa-bell" id="notifications-btn" style="cursor: pointer;"></i>
                <i class="fas fa-cog" id="settings-btn" style="cursor: pointer;"></i>
            </div>
        </div>
        <div class="date-display" id="current-date">Cargando fecha...</div>
    </header>

    <!-- Notificaci√≥n -->
    <div class="notification" id="notification"></div>

    <!-- Banner de Instalaci√≥n PWA -->
    <div class="install-banner" id="install-banner">
        <div class="install-banner-content">
            <div class="install-banner-icon">üéì</div>
            <div class="install-banner-text">
                <h3>Instalar Mi Vida UPMH</h3>
                <p>Accede m√°s r√°pido y √∫sala sin conexi√≥n</p>
            </div>
            <div class="install-banner-actions">
                <button class="install-btn" id="install-btn">Instalar</button>
                <button class="dismiss-btn" id="dismiss-install">Ahora no</button>
            </div>
        </div>
    </div>

    <!-- Barra de progreso de instalaci√≥n -->
    <div class="install-progress" id="install-progress">
        <div class="install-progress-content">
            <div class="install-progress-icon">üì≤</div>
            <h3>Instalando Mi Vida UPMH</h3>
            <div class="install-progress-bar">
                <div class="install-progress-fill" id="install-progress-fill"></div>
            </div>
            <p class="install-progress-text" id="install-progress-text">Preparando la aplicaci√≥n...</p>
        </div>
    </div>

    <main class="container">
        <!-- Secci√≥n de Inicio -->
        <div id="page-inicio" class="page-section">
        <!-- Tarjeta de Bienvenida -->
        <div class="welcome-card">
            <div class="welcome-header">
                <div>
                    <h2>¬°Hola de nuevo! üëã</h2>
                    <p id="welcome-message">Cargando...</p>
                </div>
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>

        <!-- Estad√≠sticas -->
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-icon">üìö</div>
                <div class="stat-info">
                    <div class="stat-value" id="task-count">0/0</div>
                    <div class="stat-label">Tareas</div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">‚ù§Ô∏è</div>
                <div class="stat-info">
                    <div class="stat-value" id="emotion-count">0</div>
                    <div class="stat-label">Emociones</div>
                </div>
            </div>
        </div>

        <!-- Acciones R√°pidas -->
        <div class="quick-actions">
            <button class="action-btn" id="add-task-btn">
                <div class="action-emoji">üìù</div>
                <span>Nueva Tarea</span>
            </button>
            <button class="action-btn" id="add-event-btn">
                <div class="action-emoji">üìÖ</div>
                <span>Agregar Evento</span>
            </button>
            <button class="action-btn" id="add-person-btn">
                <div class="action-emoji">üë•</div>
                <span>Agregar Persona</span>
            </button>
            <button class="action-btn" id="add-emotion-btn">
                <div class="action-emoji">üòä</div>
                <span>Registrar Emoci√≥n</span>
            </button>
        </div>

        <!-- Tareas Pendientes -->
        <div class="section-title">
            <h3>Tareas Pendientes üìã</h3>
            <a href="#" class="see-all" id="see-all-tasks">Ver todas</a>
        </div>
        <div class="cards-scroll" id="tasks-scroll">
            <!-- Las tareas se cargar√°n din√°micamente -->
        </div>

        <!-- Pr√≥ximos Eventos -->
        <div class="section-title">
            <h3>Pr√≥ximos Eventos üóìÔ∏è</h3>
            <a href="#" class="see-all" id="see-all-events">Ver todos</a>
        </div>
        <div class="cards-scroll" id="events-scroll">
            <!-- Los eventos se cargar√°n din√°micamente -->
        </div>

        <!-- Personas Especiales -->
        <div class="section-title">
            <h3>Personas Especiales üë®‚Äçüë©‚Äçüëß‚Äçüë¶</h3>
            <a href="#" class="see-all" id="see-all-people">Ver todas</a>
        </div>
        <div class="cards-scroll" id="people-scroll">
            <!-- Las personas se cargar√°n din√°micamente -->
        </div>

        <!-- Bienestar Social -->
        <div class="section-title">
            <h3>Bienestar Social ‚ù§Ô∏è</h3>
        </div>

        <div class="emotion-form">
            <form id="emotion-form">
                <div class="form-group">
                    <label for="person-select">Persona:</label>
                    <select id="person-select" class="form-control" required>
                        <option value="">Selecciona una persona</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Emociones que sentiste:</label>
                    <div class="emotion-tags">
                        <span class="emotion-tag" data-emotion="Alegr√≠a">
                            <span class="emoji">üòä</span> Alegr√≠a
                        </span>
                        <span class="emotion-tag" data-emotion="Tristeza">
                            <span class="emoji">üò¢</span> Tristeza
                        </span>
                        <span class="emotion-tag" data-emotion="Enojo">
                            <span class="emoji">üò†</span> Enojo
                        </span>
                        <span class="emotion-tag" data-emotion="Miedo">
                            <span class="emoji">üò®</span> Miedo
                        </span>
                        <span class="emotion-tag" data-emotion="Sorpresa">
                            <span class="emoji">üò≤</span> Sorpresa
                        </span>
                        <span class="emotion-tag" data-emotion="Confianza">
                            <span class="emoji">üòå</span> Confianza
                        </span>
                        <span class="emotion-tag" data-emotion="Amor">
                            <span class="emoji">‚ù§Ô∏è</span> Amor
                        </span>
                        <span class="emotion-tag" data-emotion="Frustraci√≥n">
                            <span class="emoji">üò§</span> Frustraci√≥n
                        </span>
                    </div>
                    <input type="hidden" id="selected-emotions">
                </div>
                <div class="form-group">
                    <label for="emotion-description">Descripci√≥n:</label>
                    <textarea id="emotion-description" class="form-control" rows="3" placeholder="Describe la situaci√≥n y tus sentimientos..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Registrar Emoci√≥n ‚ú®</button>
            </form>
        </div>

        <!-- An√°lisis de Relaciones -->
        <div class="emotion-form">
            <h3>An√°lisis de Relaciones üîç</h3>
            <div class="form-group">
                <label for="analysis-person">Persona a analizar:</label>
                <select id="analysis-person" class="form-control">
                    <option value="">Todas las personas</option>
                </select>
            </div>
            <button id="analyze-btn" class="btn btn-primary">Analizar Relaci√≥n üìä</button>

            <div id="analysis-result" class="analysis-result" style="display: none;">
                <h4>Resultados del an√°lisis:</h4>
                <p id="analysis-text"></p>
                <div id="recommendation" class="recommendation" style="display: none;">
                    <h4>Recomendaci√≥n üí°</h4>
                    <p id="recommendation-text"></p>
                </div>
            </div>
        </div>
        </div>
        <!-- Fin Secci√≥n de Inicio -->

        <!-- Secci√≥n de Horario -->
        <div id="page-horario" class="page-section" style="display: none;">
            <div class="section-title">
                <h3>Mi Horario üìÖ</h3>
            </div>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-icon">üïê</div>
                    <div class="stat-info">
                        <div class="stat-value" id="classes-today">0</div>
                        <div class="stat-label">Clases Hoy</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-info">
                        <div class="stat-value" id="total-classes">0</div>
                        <div class="stat-label">Clases Semanales</div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 1.5rem;">
                <div id="schedule-container">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìÖ</div>
                            <h3>Lunes</h3>
                        </div>
                        <div class="event-item">
                            <div class="event-time">08:00</div>
                            <div class="event-text">C√°lculo Diferencial - Aula 201</div>
                        </div>
                        <div class="event-item">
                            <div class="event-time">10:00</div>
                            <div class="event-text">Programaci√≥n I - Lab 3</div>
                        </div>
                        <div class="event-item">
                            <div class="event-time">14:00</div>
                            <div class="event-text">Bases de Datos - Aula 305</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìÖ</div>
                            <h3>Martes</h3>
                        </div>
                        <div class="event-item">
                            <div class="event-time">09:00</div>
                            <div class="event-text">√âtica Profesional - Aula 102</div>
                        </div>
                        <div class="event-item">
                            <div class="event-time">11:00</div>
                            <div class="event-text">F√≠sica - Aula 204</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìÖ</div>
                            <h3>Mi√©rcoles</h3>
                        </div>
                        <div class="event-item">
                            <div class="event-time">08:00</div>
                            <div class="event-text">C√°lculo Diferencial - Aula 201</div>
                        </div>
                        <div class="event-item">
                            <div class="event-time">10:00</div>
                            <div class="event-text">Programaci√≥n I - Lab 3</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìÖ</div>
                            <h3>Jueves</h3>
                        </div>
                        <div class="event-item">
                            <div class="event-time">09:00</div>
                            <div class="event-text">√âtica Profesional - Aula 102</div>
                        </div>
                        <div class="event-item">
                            <div class="event-time">14:00</div>
                            <div class="event-text">Bases de Datos - Aula 305</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìÖ</div>
                            <h3>Viernes</h3>
                        </div>
                        <div class="event-item">
                            <div class="event-time">10:00</div>
                            <div class="event-text">Ingl√©s - Aula 401</div>
                        </div>
                        <div class="event-item">
                            <div class="event-time">12:00</div>
                            <div class="event-text">Desarrollo Web - Lab 2</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Fin Secci√≥n de Horario -->

        <!-- Secci√≥n de Progreso -->
        <div id="page-progreso" class="page-section" style="display: none;">
            <div class="section-title">
                <h3>Mi Progreso Acad√©mico üìä</h3>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1rem;">Promedio General</h3>
                <div style="text-align: center;">
                    <div style="font-size: 3rem; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.5rem;">8.7</div>
                    <p style="color: #777;">Buen rendimiento acad√©mico</p>
                </div>
            </div>

            <div class="section-title">
                <h3>Materias üìö</h3>
            </div>

            <div class="card">
                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="font-weight: 600;">C√°lculo Diferencial</span>
                        <span style="font-weight: 700; color: var(--primary-color);">9.2</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 92%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));"></div>
                    </div>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="font-weight: 600;">Programaci√≥n I</span>
                        <span style="font-weight: 700; color: var(--primary-color);">9.5</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 95%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));"></div>
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="font-weight: 600;">Bases de Datos</span>
                        <span style="font-weight: 700; color: var(--primary-color);">8.8</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 88%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));"></div>
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="font-weight: 600;">√âtica Profesional</span>
                        <span style="font-weight: 700; color: var(--primary-color);">8.5</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));"></div>
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="font-weight: 600;">F√≠sica</span>
                        <span style="font-weight: 700; color: var(--primary-color);">7.9</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 79%; background: linear-gradient(90deg, var(--warning-color), var(--danger-color));"></div>
                    </div>
                </div>

                <div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="font-weight: 600;">Ingl√©s</span>
                        <span style="font-weight: 700; color: var(--primary-color);">8.4</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 84%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));"></div>
                    </div>
                </div>
            </div>

            <div class="section-title">
                <h3>Estad√≠sticas del Semestre üìà</h3>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-info">
                        <div class="stat-value">24/28</div>
                        <div class="stat-label">Tareas Entregadas</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-info">
                        <div class="stat-value">92%</div>
                        <div class="stat-label">Asistencia</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-info">
                        <div class="stat-value">5</div>
                        <div class="stat-label">Materias Aprobadas</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">‚è∞</div>
                    <div class="stat-info">
                        <div class="stat-value">120h</div>
                        <div class="stat-label">Horas de Estudio</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Fin Secci√≥n de Progreso -->

        <!-- Secci√≥n de Bienestar -->
        <div id="page-bienestar" class="page-section" style="display: none;">
            <div class="section-title">
                <h3>Bienestar Social ‚ù§Ô∏è</h3>
            </div>

            <div class="emotion-form">
                <form id="emotion-form-bienestar">
                    <div class="form-group">
                        <label for="person-select-bienestar">Persona:</label>
                        <select id="person-select-bienestar" class="form-control" required>
                            <option value="">Selecciona una persona</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Emociones que sentiste:</label>
                        <div class="emotion-tags" id="emotion-tags-bienestar">
                            <span class="emotion-tag" data-emotion="Alegr√≠a">
                                <span class="emoji">üòä</span> Alegr√≠a
                            </span>
                            <span class="emotion-tag" data-emotion="Tristeza">
                                <span class="emoji">üò¢</span> Tristeza
                            </span>
                            <span class="emotion-tag" data-emotion="Enojo">
                                <span class="emoji">üò†</span> Enojo
                            </span>
                            <span class="emotion-tag" data-emotion="Amor">
                                <span class="emoji">‚ù§Ô∏è</span> Amor
                            </span>
                            <span class="emotion-tag" data-emotion="Frustraci√≥n">
                                <span class="emoji">üò§</span> Frustraci√≥n
                            </span>
                            <span class="emotion-tag" data-emotion="Confianza">
                                <span class="emoji">ü§ù</span> Confianza
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="emotion-description-bienestar">Describe c√≥mo te sientes:</label>
                        <textarea id="emotion-description-bienestar" class="form-control" rows="4" placeholder="¬øQu√© pas√≥? ¬øC√≥mo te sentiste?" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Registrar Emoci√≥n üíù</button>
                </form>
            </div>

            <div class="section-title" style="margin-top: 2rem;">
                <h3>An√°lisis de Relaciones üîç</h3>
            </div>

            <div class="card">
                <p style="margin-bottom: 1rem; color: #777;">Analiza tus relaciones y obt√©n recomendaciones personalizadas</p>
                <button class="btn btn-primary" id="analyze-btn-bienestar">Analizar Mis Relaciones üß†</button>
                <div id="analysis-result-bienestar"></div>
            </div>

            <div class="section-title">
                <h3>Historial de Emociones üìù</h3>
            </div>
            <div id="emotions-history-bienestar"></div>
        </div>
        <!-- Fin Secci√≥n de Bienestar -->
    </main>

    <!-- Navegaci√≥n Inferior -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-page="inicio">
            <i class="fas fa-home nav-icon"></i>
            <span>Inicio</span>
        </a>
        <a href="#" class="nav-item" data-page="horario">
            <i class="fas fa-calendar nav-icon"></i>
            <span>Horario</span>
        </a>
        <a href="#" class="nav-item" data-page="progreso">
            <i class="fas fa-chart-bar nav-icon"></i>
            <span>Progreso</span>
        </a>
        <a href="#" class="nav-item" data-page="bienestar">
            <i class="fas fa-heart nav-icon"></i>
            <span>Bienestar</span>
        </a>
    </nav>

    <!-- Modal para Agregar Tarea -->
    <div class="modal" id="task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Tarea üìù</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="task-form">
                <div class="form-group">
                    <label for="task-title">T√≠tulo</label>
                    <input type="text" id="task-title" class="form-control" placeholder="Ej: Proyecto de Programaci√≥n" required>
                </div>
                <div class="form-group">
                    <label for="task-description">Descripci√≥n</label>
                    <textarea id="task-description" class="form-control" rows="3" placeholder="Detalles de la tarea..."></textarea>
                </div>
                <div class="form-group">
                    <label for="task-priority">Prioridad</label>
                    <select id="task-priority" class="form-control">
                        <option value="low">üü¢ Baja</option>
                        <option value="medium">üü° Media</option>
                        <option value="high">üî¥ Alta</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="task-deadline">Fecha l√≠mite</label>
                    <input type="date" id="task-deadline" class="form-control">
                </div>
                <button type="submit" class="btn btn-primary">Agregar Tarea ‚úÖ</button>
            </form>
        </div>
    </div>

    <!-- Modal para Agregar Persona -->
    <div class="modal" id="person-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agregar Persona üë•</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="person-form">
                <div class="form-group">
                    <label for="person-name">Nombre</label>
                    <input type="text" id="person-name" class="form-control" placeholder="Nombre de la persona" required>
                </div>
                <div class="form-group">
                    <label for="person-relation">Relaci√≥n</label>
                    <select id="person-relation" class="form-control" required>
                        <option value="">Selecciona una relaci√≥n</option>
                        <option value="Amigo/a">üë´ Amigo/a</option>
                        <option value="Pareja">üíë Pareja</option>
                        <option value="Familiar">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familiar</option>
                        <option value="Compa√±ero/a de clase">üéì Compa√±ero/a de clase</option>
                        <option value="Profesor/a">üë®‚Äçüè´ Profesor/a</option>
                        <option value="Mentor">üß† Mentor</option>
                        <option value="Otro">‚ùì Otro</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Agregar Persona ‚úÖ</button>
            </form>
        </div>
    </div>

    <!-- Modal para Agregar Evento -->
    <div class="modal" id="event-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Evento üìÖ</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="event-form">
                <div class="form-group">
                    <label for="event-title">T√≠tulo</label>
                    <input type="text" id="event-title" class="form-control" placeholder="Ej: Clase de Programaci√≥n" required>
                </div>
                <div class="form-group">
                    <label for="event-date">Fecha</label>
                    <input type="date" id="event-date" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="event-time">Hora</label>
                    <input type="time" id="event-time" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="event-description">Descripci√≥n</label>
                    <textarea id="event-description" class="form-control" rows="3" placeholder="Detalles del evento..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Agregar Evento ‚úÖ</button>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n de Eliminaci√≥n -->
    <div class="modal" id="delete-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="delete-title">Confirmar Eliminaci√≥n üóëÔ∏è</h3>
                <button class="close-modal">&times;</button>
            </div>
            <p id="delete-message">¬øEst√°s seguro de que quieres eliminar este elemento?</p>
            <div class="modal-actions">
                <button class="btn btn-cancel" id="cancel-delete">Cancelar</button>
                <button class="btn btn-danger" id="confirm-delete">Eliminar</button>
            </div>
        </div>
    </div>

    <script>
        // ========== DATOS Y ESTADO ==========
        let appData = {
            tasks: [
                { id: 1, title: "Proyecto de Bases de Datos", completed: false, priority: "high", deadline: "2023-10-20", description: "Entregar el proyecto final" },
                { id: 2, title: "Ensayo de √âtica", completed: false, priority: "medium", deadline: "2023-10-18", description: "Ensayo sobre dilemas √©ticos" },
                { id: 3, title: "Ejercicios de C√°lculo", completed: true, priority: "low", deadline: "2023-10-15", description: "Cap√≠tulo 5 ejercicios 1-10" }
            ],
            events: [
                { id: 1, title: "Clase de Programaci√≥n", date: "2023-10-16", time: "15:30", description: "Aula 304" },
                { id: 2, title: "Reuni√≥n equipo proyecto", date: "2023-10-16", time: "17:00", description: "Biblioteca central" },
                { id: 3, title: "Entrega de tarea de F√≠sica", date: "2023-10-17", time: "23:59", description: "Subir al campus virtual" }
            ],
            people: [
                { id: 1, name: "Ana Garc√≠a", relation: "Amigo/a", emoji: "üë´" },
                { id: 2, name: "Carlos Mendoza", relation: "Pareja", emoji: "üíë" },
                { id: 3, name: "Prof. Rodr√≠guez", relation: "Profesor/a", emoji: "üë®‚Äçüè´" }
            ],
            emotions: [
                { id: 1, person: "Ana Garc√≠a", date: "2023-10-15", emotions: ["Alegr√≠a", "Confianza"], description: "Pasamos un buen rato estudiando juntas" },
                { id: 2, person: "Carlos Mendoza", date: "2023-10-14", emotions: ["Amor", "Alegr√≠a"], description: "Cenamos juntos y hablamos de nuestro futuro" },
                { id: 3, person: "Prof. Rodr√≠guez", date: "2023-10-12", emotions: ["Frustraci√≥n", "Enojo"], description: "No entend√≠ bien la explicaci√≥n en clase" }
            ]
        };

        // Variables para el sistema de eliminaci√≥n
        let itemToDelete = null;
        let deleteType = null;

        // ========== TEMA OSCURO ==========
        function toggleDarkMode(enabled) {
            if (enabled) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('darkMode', 'true');
            } else {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('darkMode', 'false');
            }
        }

        function loadTheme() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }

        // ========== INICIALIZACI√ìN ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            loadInstitutionName();
            initializeApp();
            setupEventListeners();
            renderAllData();
        });

        function initializeApp() {
            // Cargar datos guardados
            const savedData = localStorage.getItem('upmhAppData');
            if (savedData) {
                appData = JSON.parse(savedData);
            }

            // Actualizar fecha y hora
            updateDateTime();
            setInterval(updateDateTime, 60000);

            // Actualizar mensaje de bienvenida
            updateWelcomeMessage();
        }

        function setupEventListeners() {
            // Modales
            document.getElementById('add-task-btn').addEventListener('click', openTaskModal);
            document.getElementById('add-person-btn').addEventListener('click', openPersonModal);
            document.getElementById('add-event-btn').addEventListener('click', openEventModal);
            document.getElementById('add-emotion-btn').addEventListener('click', scrollToEmotions);

            // Formularios
            document.getElementById('task-form').addEventListener('submit', handleTaskSubmit);
            document.getElementById('person-form').addEventListener('submit', handlePersonSubmit);
            document.getElementById('event-form').addEventListener('submit', handleEventSubmit);
            document.getElementById('emotion-form').addEventListener('submit', handleEmotionSubmit);
            document.getElementById('analyze-btn').addEventListener('click', analyzeRelationships);

            // Eliminaci√≥n
            document.getElementById('cancel-delete').addEventListener('click', closeDeleteModal);
            document.getElementById('confirm-delete').addEventListener('click', confirmDelete);

            // Cerrar modales
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });

            // Navegaci√≥n
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    navigateToPage(page);
                });
            });

            // Botones del header
            document.getElementById('notifications-btn').addEventListener('click', showNotificationsModal);
            document.getElementById('settings-btn').addEventListener('click', showSettingsModal);

            // Ver todos
            document.getElementById('see-all-tasks').addEventListener('click', function(e) {
                e.preventDefault();
                showAllItems('tasks');
            });
            document.getElementById('see-all-events').addEventListener('click', function(e) {
                e.preventDefault();
                showAllItems('events');
            });
            document.getElementById('see-all-people').addEventListener('click', function(e) {
                e.preventDefault();
                showAllItems('people');
            });
        }

        // ========== RENDERIZADO ==========
        function renderAllData() {
            renderTasks();
            renderEvents();
            renderPeople();
            updateStats();
            populatePersonSelects();
        }

        function renderTasks() {
            const container = document.getElementById('tasks-scroll');
            const pendingTasks = appData.tasks.filter(task => !task.completed);

            if (pendingTasks.length === 0) {
                container.innerHTML = `
                    <div class="card">
                        <div class="empty-state">
                            <div class="empty-icon">üéâ</div>
                            <p>¬°No tienes tareas pendientes!</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = pendingTasks.map(task => `
                <div class="card">
                    <div class="card-actions">
                        <button class="action-btn-small delete-btn" data-id="${task.id}" data-type="task">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="task-item">
                        <input type="checkbox" class="task-checkbox" data-id="${task.id}" ${task.completed ? 'checked' : ''}>
                        <div class="task-text">${task.title}</div>
                        <div class="task-priority priority-${task.priority}">
                            ${task.priority === 'high' ? 'üî¥' : task.priority === 'medium' ? 'üü°' : 'üü¢'} ${task.priority}
                        </div>
                    </div>
                    ${task.deadline ? `<div style="font-size: 0.8rem; color: #777; margin-top: 5px;">üìÖ ${formatDate(task.deadline)}</div>` : ''}
                    ${task.description ? `<div style="font-size: 0.8rem; color: #777; margin-top: 5px;">${task.description}</div>` : ''}
                </div>
            `).join('');

            // Agregar event listeners a los checkboxes
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    toggleTaskCompletion(taskId);
                });
            });

            // Agregar event listeners a los botones de eliminar
            document.querySelectorAll('.delete-btn[data-type="task"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    const task = appData.tasks.find(t => t.id === taskId);
                    if (task) {
                        openDeleteModal('task', taskId, task.title);
                    }
                });
            });
        }

        function renderEvents() {
            const container = document.getElementById('events-scroll');
            const today = new Date().toISOString().split('T')[0];
            const upcomingEvents = appData.events.filter(event => event.date >= today)
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(0, 3);

            if (upcomingEvents.length === 0) {
                container.innerHTML = `
                    <div class="card">
                        <div class="empty-state">
                            <div class="empty-icon">üìÖ</div>
                            <p>No hay eventos pr√≥ximos</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = upcomingEvents.map(event => `
                <div class="card">
                    <div class="card-actions">
                        <button class="action-btn-small delete-btn" data-id="${event.id}" data-type="event">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="event-item">
                        <div class="event-time">${event.time}</div>
                        <div class="event-text">${event.title}</div>
                    </div>
                    <div style="font-size: 0.8rem; color: #777; margin-top: 5px;">
                        üìÖ ${formatDate(event.date)} ${event.description ? `‚Ä¢ ${event.description}` : ''}
                    </div>
                </div>
            `).join('');

            // Agregar event listeners a los botones de eliminar
            document.querySelectorAll('.delete-btn[data-type="event"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const eventId = parseInt(this.getAttribute('data-id'));
                    const event = appData.events.find(e => e.id === eventId);
                    if (event) {
                        openDeleteModal('event', eventId, event.title);
                    }
                });
            });
        }

        function renderPeople() {
            const container = document.getElementById('people-scroll');

            if (appData.people.length === 0) {
                container.innerHTML = `
                    <div class="card">
                        <div class="empty-state">
                            <div class="empty-icon">üë•</div>
                            <p>No hay personas agregadas</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = appData.people.map(person => `
                <div class="card">
                    <div class="card-actions">
                        <button class="action-btn-small delete-btn" data-id="${person.id}" data-type="person">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="person-item">
                        <div class="person-avatar">${person.emoji}</div>
                        <div class="person-info">
                            <div class="person-name">${person.name}</div>
                            <div class="person-relation">${person.relation}</div>
                        </div>
                    </div>
                </div>
            `).join('');

            // Agregar event listeners a los botones de eliminar
            document.querySelectorAll('.delete-btn[data-type="person"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const personId = parseInt(this.getAttribute('data-id'));
                    const person = appData.people.find(p => p.id === personId);
                    if (person) {
                        openDeleteModal('person', personId, person.name);
                    }
                });
            });
        }

        // ========== FUNCIONALIDADES DE ELIMINACI√ìN ==========
        function openDeleteModal(type, id, name) {
            itemToDelete = id;
            deleteType = type;

            const modal = document.getElementById('delete-modal');
            const title = document.getElementById('delete-title');
            const message = document.getElementById('delete-message');

            let typeText = '';
            switch(type) {
                case 'task':
                    typeText = 'tarea';
                    break;
                case 'event':
                    typeText = 'evento';
                    break;
                case 'person':
                    typeText = 'persona';
                    break;
            }

            title.textContent = `Eliminar ${typeText} üóëÔ∏è`;
            message.textContent = `¬øEst√°s seguro de que quieres eliminar "${name}"? Esta acci√≥n no se puede deshacer.`;

            modal.style.display = 'flex';
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').style.display = 'none';
            itemToDelete = null;
            deleteType = null;
        }

        function confirmDelete() {
            if (!itemToDelete || !deleteType) return;

            switch(deleteType) {
                case 'task':
                    appData.tasks = appData.tasks.filter(task => task.id !== itemToDelete);
                    // Tambi√©n eliminar emociones relacionadas con esta persona si es una persona
                    const person = appData.people.find(p => p.id === itemToDelete);
                    if (person) {
                        appData.emotions = appData.emotions.filter(emotion => emotion.person !== person.name);
                    }
                    break;
                case 'event':
                    appData.events = appData.events.filter(event => event.id !== itemToDelete);
                    break;
                case 'person':
                    const personToDelete = appData.people.find(p => p.id === itemToDelete);
                    if (personToDelete) {
                        appData.people = appData.people.filter(person => person.id !== itemToDelete);
                        // Eliminar emociones relacionadas con esta persona
                        appData.emotions = appData.emotions.filter(emotion => emotion.person !== personToDelete.name);
                    }
                    break;
            }

            saveData();
            renderAllData();
            closeDeleteModal();
            showNotification('Elemento eliminado correctamente üóëÔ∏è');
        }

        function showAllItems(type) {
            let title, items, emptyMessage, emptyIcon;

            switch(type) {
                case 'tasks':
                    title = 'Todas las Tareas üìã';
                    items = appData.tasks;
                    emptyMessage = 'No hay tareas';
                    emptyIcon = 'üìù';
                    break;
                case 'events':
                    title = 'Todos los Eventos üìÖ';
                    items = appData.events;
                    emptyMessage = 'No hay eventos';
                    emptyIcon = 'üóìÔ∏è';
                    break;
                case 'people':
                    title = 'Todas las Personas üë•';
                    items = appData.people;
                    emptyMessage = 'No hay personas';
                    emptyIcon = 'üë§';
                    break;
            }

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${title}</h3>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${items.length === 0 ? `
                            <div class="empty-state">
                                <div class="empty-icon">${emptyIcon}</div>
                                <p>${emptyMessage}</p>
                            </div>
                        ` : items.map(item => {
                            if (type === 'tasks') {
                                return `
                                    <div class="task-item" style="padding: 1rem; border-bottom: 1px solid #eee;">
                                        <input type="checkbox" class="task-checkbox" data-id="${item.id}" ${item.completed ? 'checked' : ''}>
                                        <div class="task-text">${item.title}</div>
                                        <div class="task-priority priority-${item.priority}">
                                            ${item.priority === 'high' ? 'üî¥' : item.priority === 'medium' ? 'üü°' : 'üü¢'} ${item.priority}
                                        </div>
                                        <button class="action-btn-small delete-btn" data-id="${item.id}" data-type="task" style="margin-left: 10px;">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                `;
                            } else if (type === 'events') {
                                return `
                                    <div class="event-item" style="padding: 1rem; border-bottom: 1px solid #eee;">
                                        <div class="event-time">${item.time}</div>
                                        <div class="event-text">${item.title}</div>
                                        <button class="action-btn-small delete-btn" data-id="${item.id}" data-type="event" style="margin-left: 10px;">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                    <div style="font-size: 0.8rem; color: #777; margin-bottom: 1rem;">
                                        üìÖ ${formatDate(item.date)} ${item.description ? `‚Ä¢ ${item.description}` : ''}
                                    </div>
                                `;
                            } else if (type === 'people') {
                                return `
                                    <div class="person-item" style="padding: 1rem; border-bottom: 1px solid #eee;">
                                        <div class="person-avatar">${item.emoji}</div>
                                        <div class="person-info">
                                            <div class="person-name">${item.name}</div>
                                            <div class="person-relation">${item.relation}</div>
                                        </div>
                                        <button class="action-btn-small delete-btn" data-id="${item.id}" data-type="person" style="margin-left: 10px;">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                `;
                            }
                        }).join('')}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Event listeners para el modal
            modal.querySelector('.close-modal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });

            // Event listeners para checkboxes de tareas
            modal.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    toggleTaskCompletion(taskId);
                    document.body.removeChild(modal);
                    showAllItems('tasks');
                });
            });

            // Event listeners para botones de eliminar
            modal.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const deleteType = this.getAttribute('data-type');
                    let item;

                    if (deleteType === 'task') {
                        item = appData.tasks.find(t => t.id === id);
                    } else if (deleteType === 'event') {
                        item = appData.events.find(e => e.id === id);
                    } else if (deleteType === 'person') {
                        item = appData.people.find(p => p.id === id);
                    }

                    if (item) {
                        document.body.removeChild(modal);
                        openDeleteModal(deleteType, id, deleteType === 'task' ? item.title : item.name);
                    }
                });
            });
        }

        // ========== FUNCIONALIDADES EXISTENTES ==========
        function openTaskModal() {
            document.getElementById('task-modal').style.display = 'flex';
            document.getElementById('task-deadline').valueAsDate = new Date();
        }

        function openPersonModal() {
            document.getElementById('person-modal').style.display = 'flex';
        }

        function openEventModal() {
            document.getElementById('event-modal').style.display = 'flex';
            document.getElementById('event-date').valueAsDate = new Date();
            document.getElementById('event-time').value = '09:00';
        }

        function scrollToEmotions() {
            document.querySelector('.emotion-form').scrollIntoView({ behavior: 'smooth' });
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            itemToDelete = null;
            deleteType = null;
        }

        function handleTaskSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);

            const newTask = {
                id: Date.now(),
                title: document.getElementById('task-title').value,
                description: document.getElementById('task-description').value,
                priority: document.getElementById('task-priority').value,
                deadline: document.getElementById('task-deadline').value,
                completed: false
            };

            appData.tasks.push(newTask);
            saveData();
            renderAllData();
            closeAllModals();
            showNotification('¬°Tarea agregada correctamente! ‚úÖ');
            e.target.reset();
        }

        function handlePersonSubmit(e) {
            e.preventDefault();

            const relationEmojis = {
                "Amigo/a": "üë´",
                "Pareja": "üíë",
                "Familiar": "üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
                "Compa√±ero/a de clase": "üéì",
                "Profesor/a": "üë®‚Äçüè´",
                "Mentor": "üß†",
                "Otro": "‚ùì"
            };

            const newPerson = {
                id: Date.now(),
                name: document.getElementById('person-name').value,
                relation: document.getElementById('person-relation').value,
                emoji: relationEmojis[document.getElementById('person-relation').value] || "üë§"
            };

            appData.people.push(newPerson);
            saveData();
            renderAllData();
            closeAllModals();
            showNotification('¬°Persona agregada correctamente! üë•');
            e.target.reset();
        }

        function handleEventSubmit(e) {
            e.preventDefault();

            const newEvent = {
                id: Date.now(),
                title: document.getElementById('event-title').value,
                date: document.getElementById('event-date').value,
                time: document.getElementById('event-time').value,
                description: document.getElementById('event-description').value
            };

            appData.events.push(newEvent);
            saveData();
            renderAllData();
            closeAllModals();
            showNotification('¬°Evento agregado correctamente! üìÖ');
            e.target.reset();
        }

        function handleEmotionSubmit(e) {
            e.preventDefault();

            const selectedEmotions = Array.from(document.querySelectorAll('.emotion-tag.active'))
                .map(tag => tag.getAttribute('data-emotion'));

            if (selectedEmotions.length === 0) {
                showNotification('Por favor selecciona al menos una emoci√≥n', 'error');
                return;
            }

            const newEmotion = {
                id: Date.now(),
                person: document.getElementById('person-select').value,
                date: new Date().toISOString().split('T')[0],
                emotions: selectedEmotions,
                description: document.getElementById('emotion-description').value
            };

            appData.emotions.push(newEmotion);
            saveData();
            showNotification('¬°Emoci√≥n registrada correctamente! ‚ù§Ô∏è');
            e.target.reset();

            // Limpiar selecci√≥n de emociones
            document.querySelectorAll('.emotion-tag.active').forEach(tag => {
                tag.classList.remove('active');
            });
        }

        function toggleTaskCompletion(taskId) {
            const task = appData.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveData();
                renderAllData();
                showNotification(task.completed ? '¬°Tarea completada! üéâ' : 'Tarea marcada como pendiente');
            }
        }

        function analyzeRelationships() {
            const selectedPerson = document.getElementById('analysis-person').value;
            let filteredEmotions = appData.emotions;

            if (selectedPerson) {
                filteredEmotions = appData.emotions.filter(entry => entry.person === selectedPerson);
            }

            if (filteredEmotions.length === 0) {
                document.getElementById('analysis-text').textContent = 'No hay suficientes datos para analizar. Registra m√°s emociones primero.';
                document.getElementById('recommendation').style.display = 'none';
            } else {
                const emotionCount = {};
                filteredEmotions.forEach(entry => {
                    entry.emotions.forEach(emotion => {
                        emotionCount[emotion] = (emotionCount[emotion] || 0) + 1;
                    });
                });

                const sortedEmotions = Object.entries(emotionCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);

                let analysis = selectedPerson ? 
                    `En tu relaci√≥n con ${selectedPerson}, las emociones m√°s frecuentes son: ` :
                    `En general, tus emociones m√°s frecuentes son: `;

                analysis += sortedEmotions.map(entry => `${entry[0]} (${entry[1]} veces)`).join(', ');

                // Calcular ratio positivo/negativo
                const positiveEmotions = ['Alegr√≠a', 'Confianza', 'Amor', 'Sorpresa'];
                const negativeEmotions = ['Tristeza', 'Enojo', 'Miedo', 'Frustraci√≥n'];

                let positiveCount = 0;
                let negativeCount = 0;

                Object.entries(emotionCount).forEach(([emotion, count]) => {
                    if (positiveEmotions.includes(emotion)) {
                        positiveCount += count;
                    } else if (negativeEmotions.includes(emotion)) {
                        negativeCount += count;
                    }
                });

                const total = positiveCount + negativeCount;
                const positiveRatio = total > 0 ? (positiveCount / total) * 100 : 0;

                analysis += `. \n\nEl ${positiveRatio.toFixed(1)}% de tus emociones son positivas.`;

                document.getElementById('analysis-text').textContent = analysis;

                // Generar recomendaci√≥n
                let recommendationMsg = '';
                if (positiveRatio >= 70) {
                    recommendationMsg = '¬°Excelente! üéâ Tu relaci√≥n parece muy saludable. Sigue cultivando estos momentos positivos.';
                } else if (positiveRatio >= 40) {
                    recommendationMsg = 'Tu relaci√≥n tiene aspectos positivos y √°reas de mejora. üí≠ Considera hablar abiertamente sobre lo que te molesta.';
                } else {
                    recommendationMsg = 'Parece que hay desaf√≠os en esta relaci√≥n. ü§î Podr√≠a ser √∫til buscar apoyo o tener una conversaci√≥n honesta sobre tus sentimientos.';
                }

                document.getElementById('recommendation-text').textContent = recommendationMsg;
                document.getElementById('recommendation').style.display = 'block';
            }

            document.getElementById('analysis-result').style.display = 'block';
        }

        // ========== UTILIDADES ==========
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('es-ES', options);
        }

        function updateWelcomeMessage() {
            const hour = new Date().getHours();
            let message = '';

            if (hour < 12) message = '¬°Buenos d√≠as! ‚òÄÔ∏è';
            else if (hour < 18) message = '¬°Buenas tardes! üå§Ô∏è';
            else message = '¬°Buenas noches! üåô';

            document.getElementById('welcome-message').textContent = message;
        }

        function updateStats() {
            const completedTasks = appData.tasks.filter(task => task.completed).length;
            const totalTasks = appData.tasks.length;
            const progressPercentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;

            document.getElementById('task-count').textContent = `${completedTasks}/${totalTasks}`;
            document.getElementById('emotion-count').textContent = appData.emotions.length;
            document.getElementById('progress-fill').style.width = `${progressPercentage}%`;
        }

        function populatePersonSelects() {
            const personSelect = document.getElementById('person-select');
            const analysisSelect = document.getElementById('analysis-person');

            // Limpiar opciones excepto la primera
            while (personSelect.children.length > 1) personSelect.removeChild(personSelect.lastChild);
            while (analysisSelect.children.length > 1) analysisSelect.removeChild(analysisSelect.lastChild);

            // Agregar personas
            appData.people.forEach(person => {
                const option1 = document.createElement('option');
                option1.value = person.name;
                option1.textContent = person.name;
                personSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = person.name;
                option2.textContent = person.name;
                analysisSelect.appendChild(option2);
            });
        }

        function formatDate(dateString) {
            const options = { day: 'numeric', month: 'short' };
            return new Date(dateString).toLocaleDateString('es-ES', options);
        }

        function saveData() {
            localStorage.setItem('upmhAppData', JSON.stringify(appData));
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = type === 'error' ? 'var(--danger-color)' : 'var(--success-color)';
            notification.style.display = 'block';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // ========== NAVEGACI√ìN ENTRE P√ÅGINAS ==========
        function navigateToPage(pageName) {
            document.querySelectorAll('.page-section').forEach(section => {
                section.style.display = 'none';
            });

            const pageElement = document.getElementById('page-' + pageName);
            if (pageElement) {
                pageElement.style.display = 'block';
            }

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.querySelector(`.nav-item[data-page="${pageName}"]`)?.classList.add('active');

            if (pageName === 'bienestar') {
                populatePersonSelectsBienestar();
                renderEmotionsHistoryBienestar();
            }

            if (pageName === 'horario') {
                updateScheduleStats();
            }
        }

        function updateScheduleStats() {
            const totalClasses = 11;
            document.getElementById('total-classes').textContent = totalClasses;
            
            const today = new Date().getDay();
            let classesToday = 0;
            
            switch(today) {
                case 1: classesToday = 3; break;
                case 2: classesToday = 2; break;
                case 3: classesToday = 2; break;
                case 4: classesToday = 2; break;
                case 5: classesToday = 2; break;
                default: classesToday = 0;
            }
            
            document.getElementById('classes-today').textContent = classesToday;
        }

        // ========== MODAL DE NOTIFICACIONES ==========
        function showNotificationsModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            
            const notificationsHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Notificaciones üîî</h3>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${appData.tasks.filter(t => !t.completed && t.deadline).slice(0, 3).map(task => `
                            <div style="padding: 1rem; border-bottom: 1px solid #eee;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="background: var(--gradient); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                                        üìù
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600;">${task.title}</div>
                                        <div style="font-size: 0.8rem; color: #777;">Vence: ${formatDate(task.deadline)}</div>
                                    </div>
                                    <div class="task-priority priority-${task.priority}">
                                        ${task.priority === 'high' ? 'üî¥' : task.priority === 'medium' ? 'üü°' : 'üü¢'}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        ${appData.events.slice(0, 2).map(event => `
                            <div style="padding: 1rem; border-bottom: 1px solid #eee;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="background: var(--gradient); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                                        üìÖ
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600;">${event.title}</div>
                                        <div style="font-size: 0.8rem; color: #777;">${formatDate(event.date)} - ${event.time}</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        ${(appData.tasks.filter(t => !t.completed && t.deadline).length === 0 && appData.events.length === 0) ? `
                            <div class="empty-state">
                                <div class="empty-icon">üîï</div>
                                <p>No tienes notificaciones</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            modal.innerHTML = notificationsHTML;
            document.body.appendChild(modal);
            
            modal.querySelector('.close-modal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        // ========== MODAL DE AJUSTES ==========
        function showSettingsModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            
            const currentInstitution = localStorage.getItem('institutionName') || 'UPMH';
            
            const settingsHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Ajustes ‚öôÔ∏è</h3>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div>
                        <div style="padding: 1rem; border-bottom: 1px solid #eee;">
                            <div style="margin-bottom: 0.5rem;">
                                <div style="font-weight: 600; margin-bottom: 0.5rem;">Nombre de la Instituci√≥n üè´</div>
                                <div style="font-size: 0.8rem; color: #777; margin-bottom: 0.8rem;">Personaliza el nombre de tu escuela o universidad</div>
                                <input type="text" id="institution-name-input" class="form-control" placeholder="Ej: Mi Universidad" value="${currentInstitution}" maxlength="30">
                                <button class="btn btn-primary" id="save-institution-btn" style="width: 100%; margin-top: 0.5rem;">
                                    Guardar üíæ
                                </button>
                            </div>
                        </div>
                        
                        <div style="padding: 1rem; border-bottom: 1px solid #eee;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <div>
                                    <div style="font-weight: 600;">Notificaciones</div>
                                    <div style="font-size: 0.8rem; color: #777;">Recibe alertas de tareas y eventos</div>
                                </div>
                                <input type="checkbox" checked style="width: 20px; height: 20px; accent-color: var(--primary-color);">
                            </div>
                        </div>
                        
                        <div style="padding: 1rem; border-bottom: 1px solid #eee;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <div>
                                    <div style="font-weight: 600;">Modo Oscuro</div>
                                    <div style="font-size: 0.8rem; color: #777;">Cambia el tema de la aplicaci√≥n</div>
                                </div>
                                <input type="checkbox" id="dark-mode-toggle" style="width: 20px; height: 20px; accent-color: var(--primary-color);">
                            </div>
                        </div>
                        
                        <div style="padding: 1rem; border-bottom: 1px solid #eee;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Datos de la Aplicaci√≥n</div>
                            <button class="btn btn-danger" id="clear-data-btn" style="width: 100%; margin-top: 0.5rem;">
                                Borrar todos los datos üóëÔ∏è
                            </button>
                        </div>
                        
                        <div style="padding: 1rem;">
                            <div style="text-align: center; color: #777; font-size: 0.9rem;">
                                <p style="margin: 0.5rem 0;">Mi Vida Estudiantil v1.0</p>
                                <p style="margin: 0.5rem 0;">¬© 2025</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.innerHTML = settingsHTML;
            document.body.appendChild(modal);
            
            modal.querySelector('.close-modal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
            
            const darkModeToggle = modal.querySelector('#dark-mode-toggle');
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            darkModeToggle.checked = isDarkMode;
            
            darkModeToggle.addEventListener('change', function() {
                toggleDarkMode(this.checked);
                showNotification(this.checked ? 'Modo oscuro activado üåô' : 'Modo claro activado ‚òÄÔ∏è', 'success');
            });
            
            const clearDataBtn = modal.querySelector('#clear-data-btn');
            clearDataBtn.addEventListener('click', () => {
                if (confirm('¬øEst√°s seguro de que quieres borrar todos los datos? Esta acci√≥n no se puede deshacer.')) {
                    localStorage.removeItem('upmhAppData');
                    showNotification('Datos eliminados. Recargando... üîÑ', 'success');
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                }
            });
            
            const saveInstitutionBtn = modal.querySelector('#save-institution-btn');
            const institutionInput = modal.querySelector('#institution-name-input');
            
            saveInstitutionBtn.addEventListener('click', () => {
                const newName = institutionInput.value.trim();
                if (newName && newName.length > 0) {
                    localStorage.setItem('institutionName', newName);
                    updateInstitutionName(newName);
                    showNotification('Nombre actualizado correctamente ‚úÖ', 'success');
                    document.body.removeChild(modal);
                } else {
                    showNotification('Por favor ingresa un nombre v√°lido', 'error');
                }
            });
        }
        
        // ========== ACTUALIZAR NOMBRE DE INSTITUCI√ìN ==========
        function updateInstitutionName(name) {
            document.querySelector('.logo h1').textContent = `Mi Vida ${name} üéì`;
            document.querySelector('.mobile-header').style.background = 'var(--gradient)';
        }
        
        // Cargar nombre de instituci√≥n al iniciar
        function loadInstitutionName() {
            const savedName = localStorage.getItem('institutionName');
            if (savedName) {
                updateInstitutionName(savedName);
            }
        }

        // ========== FUNCIONES PARA BIENESTAR ==========
        function populatePersonSelectsBienestar() {
            const select = document.getElementById('person-select-bienestar');
            if (!select) return;
            
            select.innerHTML = '<option value="">Selecciona una persona</option>';
            appData.people.forEach(person => {
                const option = document.createElement('option');
                option.value = person.name;
                option.textContent = `${person.emoji} ${person.name}`;
                select.appendChild(option);
            });
        }

        function renderEmotionsHistoryBienestar() {
            const container = document.getElementById('emotions-history-bienestar');
            if (!container) return;
            
            if (appData.emotions.length === 0) {
                container.innerHTML = `
                    <div class="card">
                        <div class="empty-state">
                            <div class="empty-icon">üí≠</div>
                            <p>No has registrado emociones a√∫n</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = appData.emotions.map(emotion => `
                <div class="card" style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <strong>${emotion.person}</strong>
                        <span style="font-size: 0.8rem; color: #777;">${formatDate(emotion.date)}</span>
                    </div>
                    <div style="margin: 0.5rem 0;">
                        ${emotion.emotions.map(e => `<span class="emotion-tag active" style="margin-right: 0.5rem;">${e}</span>`).join('')}
                    </div>
                    <p style="color: #777; font-size: 0.9rem; margin-top: 0.5rem;">${emotion.description}</p>
                </div>
            `).join('');
        }

        // ========== EVENT LISTENERS ADICIONALES ==========
        // Emoci√≥n tags (p√°gina inicio)
        document.querySelectorAll('#page-inicio .emotion-tag').forEach(tag => {
            tag.addEventListener('click', function() {
                this.classList.toggle('active');
            });
        });

        // Emoci√≥n tags (p√°gina bienestar)
        document.querySelectorAll('#page-bienestar .emotion-tag').forEach(tag => {
            tag.addEventListener('click', function() {
                this.classList.toggle('active');
            });
        });

        // Formulario de emociones en p√°gina bienestar
        const emotionFormBienestar = document.getElementById('emotion-form-bienestar');
        if (emotionFormBienestar) {
            emotionFormBienestar.addEventListener('submit', function(e) {
                e.preventDefault();

                const selectedEmotions = Array.from(document.querySelectorAll('#page-bienestar .emotion-tag.active'))
                    .map(tag => tag.getAttribute('data-emotion'));

                if (selectedEmotions.length === 0) {
                    showNotification('Por favor selecciona al menos una emoci√≥n', 'error');
                    return;
                }

                const personSelect = document.getElementById('person-select-bienestar');
                if (!personSelect.value) {
                    showNotification('Por favor selecciona una persona', 'error');
                    return;
                }

                const newEmotion = {
                    id: Date.now(),
                    person: personSelect.value,
                    date: new Date().toISOString().split('T')[0],
                    emotions: selectedEmotions,
                    description: document.getElementById('emotion-description-bienestar').value
                };

                appData.emotions.push(newEmotion);
                saveData();
                renderEmotionsHistoryBienestar();
                updateStats();
                showNotification('¬°Emoci√≥n registrada correctamente! ‚ù§Ô∏è');
                e.target.reset();

                document.querySelectorAll('#page-bienestar .emotion-tag.active').forEach(tag => {
                    tag.classList.remove('active');
                });
            });
        }

        // Bot√≥n analizar en p√°gina bienestar
        const analyzeBtnBienestar = document.getElementById('analyze-btn-bienestar');
        if (analyzeBtnBienestar) {
            analyzeBtnBienestar.addEventListener('click', function() {
                const resultContainer = document.getElementById('analysis-result-bienestar');
                if (!resultContainer) return;

                if (appData.emotions.length === 0) {
                    showNotification('Primero registra algunas emociones', 'error');
                    return;
                }

                const emotionCounts = {};
                const personEmotions = {};

                appData.emotions.forEach(emotion => {
                    if (!personEmotions[emotion.person]) {
                        personEmotions[emotion.person] = [];
                    }
                    personEmotions[emotion.person].push(...emotion.emotions);

                    emotion.emotions.forEach(e => {
                        emotionCounts[e] = (emotionCounts[e] || 0) + 1;
                    });
                });

                const dominantEmotion = Object.keys(emotionCounts).reduce((a, b) => 
                    emotionCounts[a] > emotionCounts[b] ? a : b
                );

                const recommendations = {
                    'Alegr√≠a': 'Mant√©n el contacto frecuente con estas personas. Las relaciones positivas son clave para tu bienestar.',
                    'Tristeza': 'Considera hablar sobre tus sentimientos con alguien de confianza o un profesional.',
                    'Enojo': 'Toma tiempo para reflexionar sobre lo que te molesta. La comunicaci√≥n asertiva puede ayudar.',
                    'Amor': 'Cultiva estas relaciones especiales. El amor es fundamental para nuestra salud emocional.',
                    'Frustraci√≥n': 'Identifica las causas y busca soluciones pr√°cticas. A veces, un cambio de perspectiva ayuda.',
                    'Confianza': 'Las relaciones basadas en confianza son valiosas. Contin√∫a siendo honesto y leal.'
                };

                const analysisHTML = `
                    <div class="analysis-result">
                        <h4>An√°lisis de tus Relaciones üìä</h4>
                        <p><strong>Emoci√≥n predominante:</strong> ${dominantEmotion}</p>
                        <p><strong>Total de registros:</strong> ${appData.emotions.length}</p>
                        <p><strong>Personas registradas:</strong> ${Object.keys(personEmotions).length}</p>
                    </div>
                    <div class="recommendation">
                        <h4>Recomendaci√≥n üí°</h4>
                        <p>${recommendations[dominantEmotion] || 'Contin√∫a registrando tus emociones para obtener mejores insights.'}</p>
                    </div>
                `;

                resultContainer.innerHTML = analysisHTML;
                showNotification('An√°lisis completado ‚ú®');
            });
        }

        // Cerrar modal al hacer clic fuera
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAllModals();
                }
            });
        });

        // ========== PWA INSTALACI√ìN ==========
        let deferredPrompt;
        const installBanner = document.getElementById('install-banner');
        const installBtn = document.getElementById('install-btn');
        const dismissBtn = document.getElementById('dismiss-install');
        const installProgress = document.getElementById('install-progress');
        const progressFill = document.getElementById('install-progress-fill');
        const progressText = document.getElementById('install-progress-text');

        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registrado:', registration);
                    })
                    .catch((error) => {
                        console.log('Error al registrar Service Worker:', error);
                    });
            });
        }

        // Capturar evento beforeinstallprompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Verificar si ya fue instalada o rechazada
            const installDismissed = localStorage.getItem('installDismissed');
            const isInstalled = localStorage.getItem('pwaInstalled');

            if (!installDismissed && !isInstalled) {
                // Mostrar banner despu√©s de 2 segundos
                setTimeout(() => {
                    installBanner.style.display = 'block';
                }, 2000);
            }
        });

        // Bot√≥n de instalar
        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) {
                showNotification('La instalaci√≥n no est√° disponible', 'error');
                return;
            }

            installBanner.style.display = 'none';
            installProgress.style.display = 'flex';

            // Simular progreso de instalaci√≥n
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                progressFill.style.width = progress + '%';

                if (progress === 30) {
                    progressText.textContent = 'Descargando recursos...';
                } else if (progress === 60) {
                    progressText.textContent = 'Configurando la app...';
                } else if (progress === 90) {
                    progressText.textContent = 'Casi listo...';
                }

                if (progress >= 100) {
                    clearInterval(progressInterval);
                }
            }, 200);

            // Mostrar prompt de instalaci√≥n
            deferredPrompt.prompt();

            const { outcome } = await deferredPrompt.userChoice;

            if (outcome === 'accepted') {
                console.log('Usuario acept√≥ la instalaci√≥n');
                localStorage.setItem('pwaInstalled', 'true');

                // Completar barra de progreso
                setTimeout(() => {
                    progressFill.style.width = '100%';
                    progressText.textContent = '¬°Instalaci√≥n completada! ‚úÖ';

                    setTimeout(() => {
                        installProgress.style.display = 'none';
                        showNotification('¬°App instalada correctamente! üéâ');
                    }, 1500);
                }, 500);
            } else {
                console.log('Usuario rechaz√≥ la instalaci√≥n');
                clearInterval(progressInterval);
                installProgress.style.display = 'none';
                showNotification('Instalaci√≥n cancelada', 'error');
            }

            deferredPrompt = null;
        });

        // Bot√≥n de descartar
        dismissBtn.addEventListener('click', () => {
            installBanner.style.display = 'none';
            localStorage.setItem('installDismissed', 'true');

            // Permitir mostrar banner nuevamente despu√©s de 7 d√≠as
            setTimeout(() => {
                localStorage.removeItem('installDismissed');
            }, 7 * 24 * 60 * 60 * 1000);
        });

        // Detectar cuando la app se instala
        window.addEventListener('appinstalled', () => {
            console.log('PWA instalada correctamente');
            localStorage.setItem('pwaInstalled', 'true');
            installBanner.style.display = 'none';
        });

        // Verificar si ya est√° instalada (modo standalone)
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            console.log('App corriendo en modo instalado');
            localStorage.setItem('pwaInstalled', 'true');
        }
    </script>
</body>
</html>